version: "3.1"

rules:

- rule: Say goodbye anytime the user says goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye

- rule: Say 'I am a bot' anytime the user challenges
  steps:
  - intent: bot_challenge
  - action: utter_iamabot

- rule: Custom greet
  steps:
  - intent: greet
  - action: action_greet_custom

- rule: User introduced themself
  steps:
  - intent: introduce_self
  - action: action_greet_custom

- rule: Start trend form
  steps:
  - intent: request_trend
  - action: trend_form
  - active_loop: trend_form

- rule: Submit trend form
  condition:
  - active_loop: trend_form
  steps:
  - action: trend_form
  - active_loop: null
  - slot_was_set:
      - requested_slot: null
  - action: action_generate_trend_report

#- rule: User provides date range and product type
#  steps:
#  - intent: provide_date_range
#  - action: action_handle_date_range
#  - action: action_generate_trend_report

- rule: Restart trend analysis
  steps:
  - intent: restart_analysis
  - action: action_inform_restart
  - action: action_deactivate_loop
  - action: action_reset_slots


- rule: Finish profit/revenue report
  condition:
  - active_loop: profit_revenue_form
  steps:
    - action: profit_revenue_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: action_generate_profit_revenue_report

- rule: Start profit/revenue report
  steps:
    - intent: request_profit_revenue
    - action: profit_revenue_form
    - active_loop: profit_revenue_form

- rule: Ask for trend while filling profit/revenue report
  condition:
  - active_loop: profit_revenue_form
  steps:
    - intent: request_trend
    - action: action_deactivate_loop
    - action: action_reset_slots
    - action: trend_form
    - active_loop: trend_form

- rule: Ask for trend while filling trend report
  condition:
  - active_loop: trend_form
  steps:
    - intent: request_trend
    - action: action_deactivate_loop
    - action: action_reset_slots
    - action: trend_form
    - active_loop: trend_form

- rule: Ask for profit/revenue while trend report
  condition:
  - active_loop: trend_form
  steps:
    - intent: request_profit_revenue
    - action: action_deactivate_loop
    - action: action_reset_slots
    - action: profit_revenue_form
    - active_loop: profit_revenue_form

- rule: Ask for profit/revenue while profit/revenue report
  condition:
  - active_loop: profit_revenue_form
  steps:
    - intent: request_profit_revenue
    - action: action_deactivate_loop
    - action: action_reset_slots
    - action: profit_revenue_form
    - active_loop: profit_revenue_form

#- rule: Quit profit/revenue form in the middle
#  condition:
#  - active_loop: profit_revenue_form
#  steps:
#  - intent: deny
#  - action: utter_inform_done
#  - action: action_deactivate_loop
#  - action: action_reset_slots

# Out of scope - Fall back
- rule: Ask the user to rephrase in case of low NLU confidence
  steps:
    - intent: nlu_fallback
    - action: action_handle_out_of_scope

#- rule: Ask the user if they want to continue filling profit/revenue form - affirm
#  condition:
#  - active_loop: profit_revenue_form
#  steps:
#    - intent: nlu_fallback
#    - action: action_handle_out_of_scope
#    - intent: affirm
#    - action: profit_revenue_form
#    - active_loop: profit_revenue_form
#
#- rule: Ask the user if they want to continue filling profit/revenue form - deny
#  condition:
#  - active_loop: profit_revenue_form
#  steps:
#    - intent: nlu_fallback
#    - action: action_handle_out_of_scope
#    - intent: deny
#    - action: action_deactivate_loop
#    - action: action_reset_slots

#- rule: Implementation of the Two-Stage-Fallback
#  steps:
#  - intent: nlu_fallback
#  - action: action_two_stage_fallback
#  - active_loop: action_two_stage_fallback

#- rule: User interrupt the slot filling of form
#  condition:
#  - active_loop: profit_revenue_form
#  steps:
#  - intent: nlu_fallback
#  - action: